plugins {
    id 'java'
    id 'org.springframework.boot' version '3.4.5'
    id 'io.spring.dependency-management' version '1.1.7'
}
ext {
    springBootVersion = '3.2.5'
}
group = 'com.example'
version = '0.0.1-SNAPSHOT'

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(20)
    }
    sourceCompatibility = JavaVersion.VERSION_17  // Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼ Ñ Java 17
    targetCompatibility = JavaVersion.VERSION_17  // Ð±Ð°Ð¹Ñ‚-ÐºÐ¾Ð´ Ð¿Ð¾Ð´ Java 17
}

repositories {
    mavenCentral()
}


dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-web-services'

    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'

    implementation 'at.favre.lib:bcrypt:0.9.0'
    implementation 'org.postgresql:postgresql:42.4.5'


}

tasks.named('test') {
    useJUnitPlatform()
}

tasks.register('welcome') {
    group = 'custom'
    doLast {
        println "welcome from katya pim"
    }
}

def srcDirs = sourceSets.main.java.srcDirs
tasks.register('custom-compile', Exec) {
    group = 'custom'
    description = 'ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ñ… ÐºÐ¾Ð´Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°'

    def javaFiles = files(srcDirs)
            .asFileTree
            .matching { include '**/*.java' }
            .files
            .toList()

    def outputDir = layout.buildDirectory.dir("classes/java/main").get().asFile

    inputs.files javaFiles
    outputs.dir outputDir

    doFirst {
        outputDir.mkdirs()
    }

    // Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÐ¼ classpath
    def deps = sourceSets.main.compileClasspath.asPath
    def cp = [deps, outputDir.absolutePath].join(File.pathSeparator)


    commandLine = ['javac',
                   '-parameters',
                   '-d', outputDir.absolutePath,
                   '-cp', cp] + javaFiles.collect { it.absolutePath }

    doLast {
        println "âœ…Ð²ÑÐµ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð²: ${outputDir.absolutePath.replace(projectDir.absolutePath + '/', '')}"
    }
}

tasks.register('custom-build', Jar) {
    group = 'custom'
    description = 'ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ñ… ÐºÐ¾Ð´Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¸ Ð¸Ñ… ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ° Ð² Ð¸ÑÐ¿Ð¾Ð»Ð½ÑÐµÐ¼Ñ‹Ð¹ jar-Ð°Ñ€Ñ…Ð¸Ð². ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸ÑŽ Ð¸ÑÑ…Ð¾Ð´Ð½Ñ‹Ñ… ÐºÐ¾Ð´Ð¾Ð² Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð¾Ð¼ Ð²Ñ‹Ð·Ð¾Ð²Ð° Ñ†ÐµÐ»Ð¸ compile'

    def libsDir = layout.buildDirectory.dir("libs/lib").get().asFile.absolutePath

    dependsOn 'custom-compile'     //  ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ + ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ lib

    archiveBaseName = project.name
    archiveVersion = project.version.toString()

    copy {
        from configurations.runtimeClasspath
        into libsDir
    }

    from sourceSets.main.output

    manifest {
        attributes 'Main-Class': 'com.example.web4_2.Web4Application'

        def cpEntries = configurations.runtimeClasspath.files.collect {
            "lib/${it.name}"
        }
        attributes 'Class-Path': cpEntries.join(' ')
    }

    destinationDirectory = layout.buildDirectory.dir("libs")

    doLast {
        println "âœ…jar-Ð°Ñ€Ñ…Ð¸Ð² ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð±Ñ€Ð°Ð½ Ð²: ${archiveFile.get().asFile.absolutePath.replace(projectDir.absolutePath + '/', '')}"
    }
}


tasks.register('custom-clean', Exec) {
    group = "custom"
    description = "ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ»Ð°ÑÑÐ¾Ð², Ð²ÑÐµÑ… Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¸ jar-Ð°Ñ€Ñ…Ð¸Ð²Ð°"

    def buildDir = layout.buildDirectory.get().asFile.absolutePath

    commandLine "rm", "-rf", buildDir

    doLast {
        println "âœ…Ð²ÑÐµ ÑÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ»Ð°ÑÑÑ‹ Ð¸ jar-Ð°Ñ€Ñ…Ð¸Ð²Ñ‹ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹"
    }
}

tasks.register("custom-native2ascii") {

    group = "custom"
    description = "Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ native2ascii Ð´Ð»Ñ ÐºÐ¾Ð¿Ð¸Ð¹ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð»Ð¾ÐºÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ " +
            "(Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ñ Ð²ÑÐµ ÑÑ‚Ñ€Ð¾ÐºÐ¾Ð²Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð²Ñ‹Ð½ÐµÑÑ‚Ð¸ Ð¸Ð· ÐºÐ»Ð°ÑÑÐ¾Ð² Ð² Ñ„Ð°Ð¹Ð»Ñ‹ Ð»Ð¾ÐºÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸)"

    def convertToUnicode = new GroovyShell().evaluate(file('scripts/convertToUnicode.groovy'))


    def inputDir = file("src/main/resources/")
    def outputDir = layout.buildDirectory.dir("native2ascii").get().asFile

    inputs.dir inputDir
    outputs.dir outputDir

    doLast {
        if (!outputDir.exists()) {
            outputDir.mkdirs()
        }
        // Process each .properties file in the input directory
        fileTree(inputDir).matching {
            include "**/messages*.properties"
        }.each { file ->
            def relativePath = inputDir.toPath().relativize(file.toPath()).toString()
            def outputFile = new File(outputDir, relativePath)
            outputFile.parentFile.mkdirs()
            println "converting: ${file}"
            outputFile.withWriter("UTF-8") { writer ->
                file.eachLine("UTF-8") { line ->
                    writer.writeLine((String) convertToUnicode(line))
                }
            }
        }
        println "âœ…ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°. Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð²: ${outputDir}"
    }

}

tasks.register("custom-scp", Exec) {
    group = "custom"
    description = "Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ ÑÐ¾Ð±Ñ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð¿Ð¾ scp Ð½Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€ Ð¿Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸ÑŽ ÑÐ±Ð¾Ñ€ÐºÐ¸. ÐŸÑ€ÐµÐ´Ð²Ð°Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÐ±Ð¾Ñ€ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ñ†ÐµÐ»ÑŒ build)"

    dependsOn("custom-build")

    def jarFile = layout.buildDirectory.file("libs/${project.name}-${project.version}.jar").get().asFile.absolutePath

    def remoteHost = "helios.se.ifmo.ru"
    def remoteUser = "s409342"
    def remoteDirWebLab4 = "~/web_lab4"


    doFirst {
        println "Copying JAR to ${remoteUser}@${remoteHost}:${remoteDirWebLab4}"
    }

    commandLine "scp", "-P 2222", jarFile, "${remoteUser}@${remoteHost}:${remoteDirWebLab4}"

    doLast {
        println 'âœ…jar-Ð°Ñ€Ñ…Ð¸Ð² ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€'
    }
}

tasks.register("xml") {
    group = "custom"
    description = "Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… xml-Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ"

    def xmlFilesDir = layout.projectDirectory.dir("src/main/resources").asFileTree // Ð¿ÑƒÑ‚ÑŒ Ðº Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ñ xml-Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸

    doLast {
        def script = new GroovyShell().parse(file('scripts/validateXml.groovy'))

        xmlFilesDir.each { file ->
            if (file.absolutePath.endsWith(".xml")) {
                println "Ð²Ð°Ð»Ð¸Ð´Ð¸Ñ€ÑƒÑŽ Ñ„Ð°Ð¹Ð»: ${file.name}\n"
                script.validateXmlFile(file)
            }

        }
        println "âœ…Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
    }
}

tasks.register("music") {
    group = "custom"
    description = "Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¼ÑƒÐ·Ñ‹ÐºÐ¸ Ð¿Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸ÑŽ ÑÐ±Ð¾Ñ€ÐºÐ¸ (Ñ†ÐµÐ»ÑŒ build)"

    dependsOn "custom-build"

    def musicFile = file("src/main/resources/ÐœÐ°ÐºÑ ÐšÐ¾Ñ€Ð¶ - ÐœÐ°Ð»Ñ‹Ð¹ Ð¿Ð¾Ð²Ð·Ñ€Ð¾ÑÐ»ÐµÐ».mp3") // Ð¿ÑƒÑ‚ÑŒ Ð´Ð¾ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ñ„Ð°Ð¹Ð»Ð°

    doLast {
        if (!musicFile.exists()) {
            throw new GradleException("Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ð¾Ð´Ð»Ð¾Ð¹ ÐµÐ²Ñ€ÐµÐ¹ÑÐºÐ¾Ð¹ Ð¼ÑƒÐ·Ñ‹ÐºÐ¸, Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½: ${musicFile} (")
        }

        exec {
            executable = 'afplay'
            args = [musicFile.absolutePath]
        }
        println "âœ…Ð¼ÑƒÐ·Ñ‹ÐºÐ°"
    }
}

import java.security.MessageDigest

tasks.register('doc') {
    group = 'custom'
    description = 'Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² MANIFEST.MF MD5 Ð¸ SHA-1 Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°, Ð° Ñ‚Ð°ÐºÐ¶Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² Ð°Ñ€Ñ…Ð¸Ð² javadoc Ð¿Ð¾ Ð²ÑÐµÐ¼ ÐºÐ»Ð°ÑÑÐ°Ð¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.'

    dependsOn 'custom-compile'

    def outputDir = layout.buildDirectory.dir("classes/java/main/com/example/web4_2").get().asFile
    def manifestFile = layout.buildDirectory.file("tmp/custom-build/MANIFEST.MF").get().asFile
    def javadocDir = layout.buildDirectory.dir("docs/javadoc").get().asFile
    def javadocJar = layout.buildDirectory.file("docs/javadoc.jar").get().asFile

    doLast {
        println "Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑŽ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒÐ½Ñ‹Ðµ ÑÑƒÐ¼Ð¼Ñ‹ MD5 SHA-1..."

        def files = outputDir.listFiles().findAll { it.isFile() }

        def md5Digest = MessageDigest.getInstance("MD5")
        def sha1Digest = MessageDigest.getInstance("SHA-1")

        def md5Strings = []
        def sha1Strings = []

        files.each { file ->
            def bytes = file.bytes
            md5Digest.update(bytes)
            sha1Digest.update(bytes)

            def md5Hex = md5Digest.digest().encodeHex().toString()
            def sha1Hex = sha1Digest.digest().encodeHex().toString()

            md5Strings << "${file.name}: $md5Hex"
            sha1Strings << "${file.name}: $sha1Hex"

            // ÐžÐ±Ð½ÑƒÐ»ÑÐµÐ¼ digest Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
            md5Digest.reset()
            sha1Digest.reset()
        }

        // Ð”Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð² MANIFEST
        manifestFile.parentFile.mkdirs()
        manifestFile.text += "\r\n" // Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
        manifestFile.text += "MD5-Checksums: ${md5Strings.join(', ')}\r\n"
        manifestFile.text += "SHA1-Checksums: ${sha1Strings.join(', ')}\r\n"

        println "MD5 Ð¸ SHA-1 Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð² Ð¼Ð°Ð½Ð¸Ñ„ÐµÑÑ‚"

        println "Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑŽ Javadoc..."

        ant.javadoc(
                destdir: javadocDir,
                sourcepath: sourceSets.main.java.srcDirs.join(File.pathSeparator),
                packagenames: "*",
                classpath: configurations.runtimeClasspath.asPath,
                encoding: "UTF-8"
        )

        ant.jar(
                destfile: javadocJar,
                basedir: javadocDir
        )

        println "âœ…Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Javadoc ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð´Ð°Ð½Ð°: ${javadocJar}"
    }
}

tasks.register('custom-diff') {
    group = 'custom'
    description = 'Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¹ ÐºÐ¾Ð¿Ð¸Ð¸, Ð¸, ÐµÑÐ»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ°ÑÐ°ÑŽÑ‚ÑÑ ÐºÐ»Ð°ÑÑÐ¾Ð², ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ñ… Ð² Ñ„Ð°Ð¹Ð»Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð² Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ commit Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ git.'

    def paramFile = file('monitoring_classes.txt')

    inputs.file paramFile
    outputs.dir layout.buildDirectory.dir('git-status')

    doLast {
        def modifiedClasses = []
        def monitoredClasses = paramFile.readLines().collect {
                it.trim()
            }.findAll {
                it
            }

        def gitStatusResult = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'status', '--porcelain'
            standardOutput = gitStatusResult
        }

        def gitStatus = gitStatusResult.toString().trim()

        gitStatus.eachLine { line ->
            def parts = line.trim().split(" ", 2)
            def typeOfChange = parts[0] // M: Modified A: Added D: Deleted R: Renamed C: Copied U: Unmerged ??: Untracked
            def filePath = parts[1]


            if (filePath.endsWith('.java')) {
                def className = filePath.replace('.java', '').replace('/', '.')

                if (monitoredClasses.contains(className)) {
                    modifiedClasses << filePath
                    println "âš™ï¸Ð±Ñ‹Ð»Ð¸ Ð²Ð½ÐµÑÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ°ÑÐ°ÐµÐ¼Ð¾ ÑÑ‚Ð¾Ð³Ð¾ ÐºÐ»Ð°ÑÑÐ°: $className"
                }
            }
        }

        if (modifiedClasses) {
            println "âš™ï¸ÑÐµÐ¹Ñ‡Ð°Ñ Ñ ÑÐ´ÐµÐ»Ð°ÑŽ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚..."
            exec {
                commandLine 'git', 'add', modifiedClasses.join(" ")
            }
            exec {
                commandLine 'git', 'commit', '-m', "committing changes for monitored classes: ${modifiedClasses.join(', ')}"
            }
            println "âœ…Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ°ÑÐ°ÐµÐ¼Ð¾ ÐºÐ»Ð°ÑÑÐ¾Ð² ${modifiedClasses.join(', ')} Ð±Ñ‹Ð»Ð¸ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°ÐºÐ¾Ð¼Ð¼Ð¸Ñ‡ÐµÐ½Ñ‹"
        } else {
            println "âœ…Ð² ÐºÐ»Ð°ÑÑÑ‹, Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð² monitoring_classes.txt Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð²Ð½ÐµÑÐµÐ½Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹"
        }
    }
}

tasks.register('custom-env') {
    group = 'custom'
    description = 'Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÐµÑ‚ ÑÐ±Ð¾Ñ€ÐºÑƒ Ð¸ Ð·Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹ Ð² Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸ÑÑ…; ' +
            'Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°ÐµÑ‚ÑÑ Ð²ÐµÑ€ÑÐ¸ÐµÐ¹ java Ð¸ Ð½Ð°Ð±Ð¾Ñ€Ð¾Ð¼ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¼Ð°ÑˆÐ¸Ð½Ñ‹ Ð² Ñ„Ð°Ð¹Ð»Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð².'

    def envFile = file('env.properties')

    inputs.file envFile
    outputs.dir layout.buildDirectory.dir('env-output')

    doLast {
        def props = new Properties()
        envFile.withInputStream {
            props.load(it)
        }
        def javaVersion = props.getProperty('java.version')
        def jvmArgsList = props.getProperty('jvm.args', '').split("\\s+").findAll { it }

        println "ðŸ›  Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Java Ð²ÐµÑ€ÑÐ¸Ñ: $javaVersion"
        println "ðŸ›  JVM Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹: $jvmArgsList"


        def jarPath = "${buildDir}/libs/web4_2-0.0.1-SNAPSHOT.jar"
        exec {
            executable(javaExecutable)
            args(jvmArgsList + [ "-jar", jarPath])
        }
    }
}

